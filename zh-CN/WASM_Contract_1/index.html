<!doctype html>
<html lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="search" type="application/opensearchdescription+xml" title="PlatON" href="/docs/zh-CN/opensearch.xml">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.0/dist/mermaid.min.js"></script>
<script src="/docs/js/custom.js"></script><title data-react-helmet="true">PlatON WASM合约开发（一） - 合约开发入门 | PlatON</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://luo-dahui.github.io//docs/zh-CN/WASM_Contract_1"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="PlatON WASM合约开发（一） - 合约开发入门 | PlatON"><meta data-react-helmet="true" name="description" content="PlatON隐私AI网络是面向未来的全球隐私计算网络，是全数字经济时代的公共基础设施。区块链生态的建设主要建立在智能合约之上，PlatON隐私计算基础设施，能够解决区块链生态发展的技术瓶颈，使链上匮乏的算力能够革命性的提升，使被传统互联网漠视的隐私保护能够得到有效的尊重，使不可信环境中的参与者能够可信的协同，真正成为数字经济的底层动能。"><meta data-react-helmet="true" property="og:description" content="PlatON隐私AI网络是面向未来的全球隐私计算网络，是全数字经济时代的公共基础设施。区块链生态的建设主要建立在智能合约之上，PlatON隐私计算基础设施，能够解决区块链生态发展的技术瓶颈，使链上匮乏的算力能够革命性的提升，使被传统互联网漠视的隐私保护能够得到有效的尊重，使不可信环境中的参与者能够可信的协同，真正成为数字经济的底层动能。"><meta data-react-helmet="true" property="og:image" content="https://luo-dahui.github.io//docs/zh-CN/img/undraw_online.svg"><meta data-react-helmet="true" name="twitter:image" content="https://luo-dahui.github.io//docs/zh-CN/img/undraw_online.svg"><link data-react-helmet="true" rel="shortcut icon" href="/docs/zh-CN/img/logo.png"><link data-react-helmet="true" rel="canonical" href="https://luo-dahui.github.io//docs/zh-CN/WASM_Contract_1"><link data-react-helmet="true" rel="alternate" href="https://luo-dahui.github.io//docs/WASM_Contract_1" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://luo-dahui.github.io//docs/zh-CN/WASM_Contract_1" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://luo-dahui.github.io//docs/WASM_Contract_1" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/docs/zh-CN/assets/css/styles.9355613d.css">
<link rel="preload" href="/docs/zh-CN/assets/js/runtime~main.479eab5f.js" as="script">
<link rel="preload" href="/docs/zh-CN/assets/js/main.56d9618d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">跳到主要内容</a></div><nav class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/zh-CN/"><img src="/docs/zh-CN/img/PlatON-logo.svg" alt="PlatON" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/docs/zh-CN/img/PlatON-logo.svg" alt="PlatON" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"></a></div><div class="navbar__items navbar__items--right"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span>中文</span></a><ul class="dropdown__menu"><li><a href="/docs/en/WASM_Contract_1" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/docs/zh-CN/WASM_Contract_1" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/docs/zh-CN/"><img src="/docs/zh-CN/img/PlatON-logo.svg" alt="PlatON" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/docs/zh-CN/img/PlatON-logo.svg" alt="PlatON" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span>Languages</span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/en/WASM_Contract_1" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/docs/zh-CN/WASM_Contract_1" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">中文</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu menu--responsive thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J" aria-label="Sidebar navigation"><button aria-label="打开菜单" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_iZzd" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/zh-CN/">概述</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">初步了解</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/lat_introduced">什么是LAT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/staking_and_delegation">质押&amp;委托</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Network_Description">网络说明</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">进阶了解</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_Overall_Solution">总体架构</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Economic_Model">经济模型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_Solution">共识机制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_Governance_Solution">治理机制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Wasm_Operation_Principle">Wasm虚拟机</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">PlatON节点</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_Validation_Introduce">验证节点介绍</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Become_PlatON_Main_Verification">成为主网验证节点</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">节点工具</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/OnLine_MTool_Manual">MTool在线教程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/OffLine_MTool_Manual">MTool离线教程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Command_Line_Tools">命令行工具</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/CTool_Manual">CTool教程</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">开发者</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_Overview_DevGuide">开发指南</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">设置开发环境</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Join_Dev_Network">开发网络</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Build_Private_Chain">私有网络</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">智能合约</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">系统合约</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_system_contract">系统合约</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_system_contract_api">系统合约接口说明</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Solidity合约</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Solidity_Dev_Manual">入门手册</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Solidity_Contract_Migrate">迁移教程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Solidity_Contract_Dev_Costs">开发成本</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Solidity_Contract_Best_Practice">最佳实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Solidity_Contract_Security_Dev_Guide">安全指南</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Solidity_Inner_Contract">调用内置合约</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">Wasm合约</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Wasm_Dev_Manual">入门手册</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Wasm_Contract_Dev_Costs">开发成本</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Wasm_Contract_Best_Practice">最佳实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Wasm_Contract_API">合约API</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">API参考</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Python_SDK">Python SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/JS_SDK">JS SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Java_SDK">Java SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Go_SDK">Go SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/NET_SDK">.NET SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Json_Rpc">JSON RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/GraphQL_Server">GraphQL Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Explorer_API">Explorer API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Samurai_API">Samurai API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="-1">PRC Token</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PRC20_contract">PRC-20</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PRC721_contract">PRC-721</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">数据分析</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatON_BlockChain_Browser">PlatScan</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/PlatEye">PlatEye</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">示例教程</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/DApp_migrate">以太坊DApp快速迁移教程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/qianqian_prc721_tutorial">PRC721NFT发行教程</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Wasm教程</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/zh-CN/WASM_Contract_1">WASM合约开发入门</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_2">WASM跨合约调用</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_3">WASM事件机制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_4">WASM参数传递详解</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_5">WASM代理机制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_6">WASM代理机制中访问合约事件</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_7">WASM通用代理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_8">WASM内置数据结构</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/WASM_Contract_9">WASM内置数据结构性能测评</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">WalletConnect</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/walletconnect_tutorial">WalletConnect</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/DApp_integration_with_WalletConnect_for_ATON">WalletConnect集成教程</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/get_vrf_random_number">获取随机数教程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/adapting_to_new_chainid">适配新链ID教程</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-CN/eip55-bech32-compatible">EIP55和Bech32地址格式兼容方案</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">钱包</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/ATON-user-manual">ATON操作指南</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Samurai_user_manual">Samurai</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Third_Party_Walle">第三方钱包</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/Ledger-hardware-wallet">Ledger 硬件钱包</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/zh-CN/MetaMask">MetaMask</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/zh-CN/community">社区项目</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="markdown"><header><h1 class="h1Heading_dC7a">PlatON WASM合约开发（一） - 合约开发入门</h1></header><p>PlatON隐私AI网络是面向未来的全球隐私计算网络，是全数字经济时代的公共基础设施。区块链生态的建设主要建立在智能合约之上，PlatON隐私计算基础设施，能够解决区块链生态发展的技术瓶颈，使链上匮乏的算力能够革命性的提升，使被传统互联网漠视的隐私保护能够得到有效的尊重，使不可信环境中的参与者能够可信的协同，真正成为数字经济的底层动能。</p><p>目前PlatON主网上线在即，后期除了项目的持续开发之外，还会有大量围绕PlatON的生态建设。考虑到生态建设离不开智能合约的开发，我们特此推出了智能合约开发相关系列教程，希望能够帮助大家更好地加入到PlatON生态，在PlatON上构建自己的应用。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="概述"></a>概述<a class="hash-link" href="#概述" title="标题的直接链接">#</a></h2><p>PlatON支持EVM和WASM两种智能合约，本教程主要介绍如何在PlatON上使用C++语言开发WASM智能合约。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="环境"></a>环境<a class="hash-link" href="#环境" title="标题的直接链接">#</a></h2><p><strong>系统：</strong>ubuntu18.04</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="开发语言"></a>开发语言<a class="hash-link" href="#开发语言" title="标题的直接链接">#</a></h2><p>PlatON隐私计算的基础设施与密码学结合的非常紧密，对计算效率要求非常高，因此现阶段底层主要以C++为主。C++是一款高效的语言。当然，很多语言都可以用于WASM合约开发，相信官方未来会逐步完善和推出其他语言的版本。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="构建工具"></a>构建工具<a class="hash-link" href="#构建工具" title="标题的直接链接">#</a></h2><p>platon-truffle，可以帮助开发人员完成编译、部署和调试合约。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="安装方式"></a>安装方式<a class="hash-link" href="#安装方式" title="标题的直接链接">#</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wget http://111.231.58.192/install-platon-truffle.sh &amp;&amp; sudo bash install-platon-truffle.sh</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p><strong>注意</strong>
会输出错误信息，但是platon-truffle --version能够正常输出即可</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="使用手册"></a>使用手册<a class="hash-link" href="#使用手册" title="标题的直接链接">#</a></h2><p><a href="https://platon-truffle.readthedocs.io/en/v0.13.1/" target="_blank" rel="noopener noreferrer">https://platon-truffle.readthedocs.io/en/v0.13.1/</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="合约开发"></a>合约开发<a class="hash-link" href="#合约开发" title="标题的直接链接">#</a></h2><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="创建项目"></a>创建项目<a class="hash-link" href="#创建项目" title="标题的直接链接">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1创建新目录"></a>1.创建新目录<a class="hash-link" href="#1创建新目录" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir HelloWorld &amp;&amp; cd HelloWorld</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2初始化工程"></a>2.初始化工程<a class="hash-link" href="#2初始化工程" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">platon-truffle init</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="编写合约"></a>编写合约<a class="hash-link" href="#编写合约" title="标题的直接链接">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="代码"></a>代码<a class="hash-link" href="#代码" title="标题的直接链接">#</a></h3><p>删除contracts目录下的Migrations.sol文件。</p><p><strong>注意**</strong>：&lt;platon/platon.hpp&gt;是开发和使用隐私计算基础设施的关键。**</p><p>在contracts目录下新建文件HelloWorld.cpp，合约内容如下</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;platon/platon.hpp&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &lt;string&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">using namespace platon;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class message {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   public:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      std::string head;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      PLATON_SERIALIZE(message, (head))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class my_message : public message {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   public:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      std::string body;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      std::string end;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      PLATON_SERIALIZE_DERIVED(my_message, message, (body)(end))</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTRACT HelloWorld : public platon::Contract{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   public:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ACTION void init(const my_message &amp;one_message){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        info.self().push_back(one_message);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ACTION void add_message(const my_message &amp;one_message){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          info.self().push_back(one_message);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      CONST uint8_t get_message_size(){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          return info.self().size();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      CONST std::string get_message_body(const uint8_t index){</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          return info.self()[index].body;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   private:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      platon::StorageType&lt;&quot;myvector&quot;_n, std::vector&lt;my_message&gt;&gt; info;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">PLATON_DISPATCH(HelloWorld, (init)(add_message)(get_message_size)(get_message_body))</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="代码说明"></a>代码说明<a class="hash-link" href="#代码说明" title="标题的直接链接">#</a></h3><ul><li>每一个合约文件只有一个合约类，合约类用 CONTRACT 修饰, 必须公有继承 platon::Contract，必须要有 init 函数。</li><li>ACTION 和 CONST 修饰的成员函数表示可调用函数，此类成员函数不可以重载。ACTION 函数会修改链上数据，CONST 函数只是查询属性不会修改链上数据。</li><li>可调用函数参数列表中的类型为自定义类型，此类型定义中需加上 PLATON_SERIALIZE 宏声明序列化函数，此类型继承自其他类型，需加上 PLATON_SERIALIZE_DERIVED 宏声明序列化函数。</li><li>可调用函数只有在PLATON_DISPATCH 宏定义统一入口函数，才能够被外部调用。</li><li>目前 platon 会将合约类的成员变量持久化存储，成员变量必须是 platon::StorageType 类型，platon::StorageType模板的第一个参数字符串后面加上_n，字符串必须为.12345abcdefghijklmnopqrstuvwxyz这32字符中的字符。第二个参数为实际存储的具体类型。成员函数修改成员变量需要通过 self() 函数获取具体类型的实例，然后执行相应的实例函数。</li><li>platon::StorageType 模板的第二个参数类型为自定义类型，此类型定义中需加上 PLATON_SERIALIZE 宏声明序列化函数，此类型继承自其他类型，需加上 PLATON_SERIALIZE_DERIVED 宏声明序列化函数。</li></ul><header><h1 class="h1Heading_dC7a">编译</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1修改配置"></a>1.修改配置<a class="hash-link" href="#1修改配置" title="标题的直接链接">#</a></h3><p>修改配置文件truffle-config.js中wasm编译器版本</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">compilers: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  wasm: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    version: &quot;v0.13.2&quot;, </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p><strong>注意</strong>
官方目前只发布了alaya版本的wasm编译器，在涉及到跨合约调用的时候，会出现地址编码问题，因此需要手动编译和安装platon版本的<a href="https://github.com/PlatONnetwork/PlatON-CDT/tree/feature/wasm" target="_blank" rel="noopener noreferrer">wasm编译器</a>。</p><p>我们已经编译了最新版本的platon版本的wasm编译器，有需要的朋友可以<a href="http://111.231.58.192/platon-cdt.zip" target="_blank" rel="noopener noreferrer">下载</a>并解压到~/.config/truffle/compilers目录下。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2编译"></a>2.编译<a class="hash-link" href="#2编译" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">platon-truffle compile</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="部署"></a>部署<a class="hash-link" href="#部署" title="标题的直接链接">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1修改配置-1"></a>1.修改配置<a class="hash-link" href="#1修改配置-1" title="标题的直接链接">#</a></h3><p>修改配置文件truffle-config.js，将连接配置修改成真实连接</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">networks: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    development: {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       host: &quot;127.0.0.1&quot;,     // 区块链所在服务器主机</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       port: 6789,            // 链端口号</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       network_id: &quot;*&quot;,       // Any network (default: none)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       from: &quot;lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n&quot;, //部署合约账号的钱包地址</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       gas: 9000000,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       gasPrice: 50000000004,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2解锁钱包账户"></a>2.解锁钱包账户<a class="hash-link" href="#2解锁钱包账户" title="标题的直接链接">#</a></h3><p>进入platon-truffle控制台</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">platon-truffle console</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>导入私钥（如果之前已导入可以跳过此步骤）</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">web3.platon.personal.importRawKey(&quot;您的钱包私钥&quot;,&quot;您的钱包密码&quot;);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>导入成功将看到私钥对应的地址：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n&#x27;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>解锁钱包账户</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">web3.platon.personal.unlockAccount(&#x27;您的钱包地址&#x27;,&#x27;您的钱包密码&#x27;,999999);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>解锁成功将看到如下信息</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">true</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>解锁
如果是使用mtool创建的keystore，使用以下命令获得私钥：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">platonkey inspect --private PATH</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>如果是ATON钱包创建的账号，在钱包中导出私钥</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3部署合约"></a>3. 部署合约<a class="hash-link" href="#3部署合约" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">platon-truffle deploy --wasm --contract-name HelloWorld --params &#x27;[[[&quot;1&quot;], &quot;2&quot;, &quot;3&quot;]]&#x27;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p> 部署成功后，将看到类似如下信息：</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">receipt:  { blockHash:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x3dd0f13fbc1771c412ea91456fe084edc3ccc2331597782904d5008cb86c2424&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  blockNumber: 3950026,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  contractAddress: &#x27;lat150nn0efn0de86mw2pcdyhlnmucln89m93sr49h&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cumulativeGasUsed: 197615,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  from: &#x27;lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  gasUsed: 197615,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  logs: [],</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  logsBloom:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  status: true,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  to: null,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transactionHash:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0xd276365d362a43c0caccc4ce74c72d2b2b27a751e22cbd8a5467ca365e638002&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transactionIndex: 0 }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">contract HelloWorld deployed successfully</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">======================</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; transactionHash:     0xd276365d362a43c0caccc4ce74c72d2b2b27a751e22cbd8a5467ca365e638002</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; contract address:    lat150nn0efn0de86mw2pcdyhlnmucln89m93sr49h</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; block number:        3950026</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; block timestamp:     1619596398292</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; account:             lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; balance:             7199525199077690925044</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; gas limit:           9424776</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; gas used:            197615</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; gas price:           0.00000002 LAT</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &gt; total cost:          0.0039523 LAT</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="测试"></a>测试<a class="hash-link" href="#测试" title="标题的直接链接">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1进入platon-truffle控制台"></a>1. 进入platon-truffle控制台<a class="hash-link" href="#1进入platon-truffle控制台" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">platon-truffle console</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>*以下调用查询将在truffle控制台中进行</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2构建合约对象"></a>2. 构建合约对象<a class="hash-link" href="#2构建合约对象" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">var abi = [{&quot;baseclass&quot;:[],&quot;fields&quot;:[{&quot;name&quot;:&quot;head&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;name&quot;:&quot;message&quot;,&quot;type&quot;:&quot;struct&quot;},{&quot;baseclass&quot;:[&quot;message&quot;],&quot;fields&quot;:[{&quot;name&quot;:&quot;body&quot;,&quot;type&quot;:&quot;string&quot;},{&quot;name&quot;:&quot;end&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;name&quot;:&quot;my_message&quot;,&quot;type&quot;:&quot;struct&quot;},{&quot;constant&quot;:false,&quot;input&quot;:[{&quot;name&quot;:&quot;one_message&quot;,&quot;type&quot;:&quot;my_message&quot;}],&quot;name&quot;:&quot;init&quot;,&quot;output&quot;:&quot;void&quot;,&quot;type&quot;:&quot;Action&quot;},{&quot;constant&quot;:false,&quot;input&quot;:[{&quot;name&quot;:&quot;one_message&quot;,&quot;type&quot;:&quot;my_message&quot;}],&quot;name&quot;:&quot;add_message&quot;,&quot;output&quot;:&quot;void&quot;,&quot;type&quot;:&quot;Action&quot;},{&quot;constant&quot;:true,&quot;input&quot;:[],&quot;name&quot;:&quot;get_message_size&quot;,&quot;output&quot;:&quot;uint8&quot;,&quot;type&quot;:&quot;Action&quot;},{&quot;constant&quot;:true,&quot;input&quot;:[{&quot;name&quot;:&quot;index&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;name&quot;:&quot;get_message_body&quot;,&quot;output&quot;:&quot;string&quot;,&quot;type&quot;:&quot;Action&quot;}];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var contractAddr = &#x27;lat150nn0efn0de86mw2pcdyhlnmucln89m93sr49h&#x27;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">var helloworld = new web3.platon.Contract(abi,contractAddr,{vmType: 1 });</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>说明：</p><ul><li><code>abi</code> 是合约提供给外部调用时的接口，每个合约对应的abi在编译后的文件中，如：<code>HelloWorld/build/contracts/HelloWorld.abi.json</code>中可以找到</li><li><code>contractAddr</code> 在部署合约成功后有一个contract address</li><li><code>helloWorld</code>就是构建出来与链上合约交互的合约对象抽象</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3调用合约"></a>3. 调用合约<a class="hash-link" href="#3调用合约" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helloworld.methods.add_message([[&quot;5&quot;], &quot;6&quot;, &quot;7&quot;]).send({</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    from: &#x27;lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n&#x27;,gas: 999999</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}).on(&#x27;receipt&#x27;, function(receipt) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    console.log(receipt);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}).on(&#x27;error&#x27;, console.error);</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>调用合约命令说明：</p><ul><li><code>helloWorld</code>是之前构建的合约对象</li><li><code>methods</code>固定语法,后面紧跟合约的方法名</li><li><code>add_message</code>是我们HelloWorld合约中的一个方法，有一个自定义my_message类型的入参</li><li><code>from</code>调用者的钱包地址</li><li><code>gas</code>gas值</li><li><code>on</code>是监听合约处理结果事件，此处如果成功将打印回执，失败输出错误日志
函数调用成功，将会看到如下信息：</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ blockHash:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x179193fcd13e44dd5d5e491ae6bc514052d3cf290e5e1f47fecf8aafc61d9da1&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  blockNumber: 3950299,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  contractAddress: null,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cumulativeGasUsed: 68359,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  from: &#x27;lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  gasUsed: 68359,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  logsBloom:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  status: true,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  to: &#x27;lat150nn0efn0de86mw2pcdyhlnmucln89m93sr49h&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transactionHash:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x31113fc77fb2f917891f24ac90f115262fd2d925268da2c4ee4d073e7c4dcd73&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transactionIndex: 0,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  events: {} }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{ blockHash:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x179193fcd13e44dd5d5e491ae6bc514052d3cf290e5e1f47fecf8aafc61d9da1&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  blockNumber: 3950299,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  contractAddress: null,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cumulativeGasUsed: 68359,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  from: &#x27;lat1ar0s6re3qpe3rt39523qw4jars6s4sdhak459n&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  gasUsed: 68359,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  logsBloom:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  status: true,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  to: &#x27;lat150nn0efn0de86mw2pcdyhlnmucln89m93sr49h&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transactionHash:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   &#x27;0x31113fc77fb2f917891f24ac90f115262fd2d925268da2c4ee4d073e7c4dcd73&#x27;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transactionIndex: 0,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  events: {} }</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="4查询合约"></a>4. 查询合约<a class="hash-link" href="#4查询合约" title="标题的直接链接">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helloworld.methods.get_message_body(0).call() </span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_M3SB clean-btn">复制</button></div></div><p>查询合约命令说明：</p><ul><li><code>helloWorld</code>是之前构建的合约对象</li><li><code>methods</code>指定将获取合约中的方法</li><li><code>get_message_body</code>是我们HelloWorld合约中的一个方法，该方法有一个int类型的入参</li><li><code>call</code>指明是查询方法</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="5其他"></a>5.其他<a class="hash-link" href="#5其他" title="标题的直接链接">#</a></h3><p>这个只是一个非常简单的合约，目的是让大家对PlatON的WASM合约有个基本的认识，后面将会为大家讲解如何进行跨合约调用，敬请期待。</p><p>想要获得更多关于合约开发的资料，请前往<a href="https://devdocs.platon.network/docs/zh-CN/WASM_Smart_Contract/" target="_blank" rel="noopener noreferrer">官网文档</a>。</p><p><em>本教程贡献者 @<a href="https://github.com/xiyu1984" target="_blank" rel="noopener noreferrer">xiyu</a></em></p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/PlatONnetwork/docs/tree/master/website/i18n/zh-CN/docusaurus-plugin-content-docs/current/PlatON WASM一-合约开发入门.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_wj+Z"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/zh-CN/qianqian_prc721_tutorial"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">« PRC721NFT发行教程</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/zh-CN/WASM_Contract_2"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">WASM跨合约调用 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link">概述</a></li><li><a href="#环境" class="table-of-contents__link">环境</a></li><li><a href="#开发语言" class="table-of-contents__link">开发语言</a></li><li><a href="#构建工具" class="table-of-contents__link">构建工具</a></li><li><a href="#安装方式" class="table-of-contents__link">安装方式</a></li><li><a href="#使用手册" class="table-of-contents__link">使用手册</a></li><li><a href="#合约开发" class="table-of-contents__link">合约开发</a></li><li><a href="#创建项目" class="table-of-contents__link">创建项目</a><ul><li><a href="#1创建新目录" class="table-of-contents__link">1.创建新目录</a></li><li><a href="#2初始化工程" class="table-of-contents__link">2.初始化工程</a></li></ul></li><li><a href="#编写合约" class="table-of-contents__link">编写合约</a><ul><li><a href="#代码" class="table-of-contents__link">代码</a></li><li><a href="#代码说明" class="table-of-contents__link">代码说明</a></li><li><a href="#1修改配置" class="table-of-contents__link">1.修改配置</a></li><li><a href="#2编译" class="table-of-contents__link">2.编译</a></li></ul></li><li><a href="#部署" class="table-of-contents__link">部署</a><ul><li><a href="#1修改配置-1" class="table-of-contents__link">1.修改配置</a></li><li><a href="#2解锁钱包账户" class="table-of-contents__link">2.解锁钱包账户</a></li><li><a href="#3部署合约" class="table-of-contents__link">3. 部署合约</a></li></ul></li><li><a href="#测试" class="table-of-contents__link">测试</a><ul><li><a href="#1进入platon-truffle控制台" class="table-of-contents__link">1. 进入platon-truffle控制台</a></li><li><a href="#2构建合约对象" class="table-of-contents__link">2. 构建合约对象</a></li><li><a href="#3调用合约" class="table-of-contents__link">3. 调用合约</a></li><li><a href="#4查询合约" class="table-of-contents__link">4. 查询合约</a></li><li><a href="#5其他" class="table-of-contents__link">5.其他</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.platon.network/" target="_blank" class="footer-logo-home" rel="noreferrer noopener"><img src="/docs/zh-CN/img/PlatON-logo2.svg" width="66" height="58"></a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.platon.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item" hrefzh="https://www.platon.network/">PlatON network</a></li><li class="footer__item"><a href="https://latticex.foundation/home" target="_blank" rel="noopener noreferrer" class="footer__link-item" hrefzh="https://latticex.foundation/home">LatticeX.Foundation</a></li><li class="footer__item"><a href="https://forum.latticex.foundation/" target="_blank" rel="noopener noreferrer" class="footer__link-item" hrefzh="https://forum.latticex.foundation/">Forum</a></li></ul></div><div class="gitstar"><a class="github-button" href="https://github.com/PlatONnetwork/PlatON-Go" data-color-scheme="no-preference: light; light: light; dark: light;" data-icon="octicon-star" data-size="small" data-show-count="true" aria-label="Star PlatONnetwork/PlatON-Go on GitHub">Star</a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">COPYRIGHT  © 2022 PLATON NETWORK.</div></div></div></footer></div>
<script src="/docs/zh-CN/assets/js/runtime~main.479eab5f.js"></script>
<script src="/docs/zh-CN/assets/js/main.56d9618d.js"></script>
</body>
</html>