---
id: 内置合约
title: 内置合约
sidebar_label: 内置合约
---

## 内置合约

在链启动之后系统内部已经内置了部分合约，这些合约的地址已固定，功能已实现，其中一部分合约为经济模型的实现，并提供各类合约与客户端进行交互。



### 惩罚合约

惩罚合约主要为了系统安全监测各个节点的行为，对破坏系统安全的违规节点执行处罚，具有以下两大功能：

- 处理不出块的节点

  按照系统规则，每个共识轮会有一批节点来负责生产该轮的区块，每个共识轮固定需要生产的区块数，其中每个节点分配了一个时间窗口和所需生产的区块个数，依次轮流出块完成整个共识轮的区块生产。当某个节点在自己负责的时间窗口内未生产出一个区块，将切换到下一个节点继续生产区块，如此循环直到完成共识轮所需的区块数整个共识轮即完成并由新的一批节点开启下一个共识轮，如果某个节点在整个共识轮中都未生产一个区块，那么该节点的零出块行为将被记录，而惩罚条件则为：从节点第一次零出块的共识轮开始记录，统计接下来的一段共识轮，如果在此期间节点再次参与了共识轮并且出块了，那么之前的零出块记录将被清除免受处罚，否则当统计时间到了节点将会受到处罚，被罚款（罚款金额=当前区块奖励*n）和状态锁定（锁定一段时间后自动解锁恢复正常状态，在锁定期间节点无法执行任何动作，包括修改信息、撤销质押、参与出块，接受委托）。

- 处理双出或双签的节点

  正常情况下节点在同一个块高只会产生一个区块或者对同一块高的不同区块只签名一个，否则属于违反规则将被处罚，当某个节点出现这种情况时区块或者签名的违规证据将会被接收到的节点记录到本地，用户可通过`RPC`调用`platon_evidences`接口获取违规的证据，然后将证据通过交易的形式发送到链上，系统将对证据进行判别，证据属实将对节点进行处罚。

#### 合约接口

1. 举报双签/双出

   该接口用于举报某个节点的双签或双出行为，用户将证据通过交易的形式发送到惩罚合约，系统核实证据属实后将对节点进行罚款和强制解除质押（取消验证人、备选节点资格），罚款中的一部分（默认：50%）将会作为奖励奖给举报者并且立即到账（转入发起举报交易的账户）。

   **输入：**证据类型（双签/双出）、证据（调用`RPC`接口`platon_evidences`获得的）

   **输出：**无

2. 查询证据是否已举报

   该接口用于发起举报之前检查即将发起举报的证据是否已经被使用过（已举报过），当用户通过调用`RPC`接口获取到证据后，可先调用该接口检查是否已举报过以避免重复举报。因为举报接口需要花费不少的成本，并且不管证据是否已举报过（使用过）该笔交易的成本依然会被花费掉，所以此接口可提供预先检查，该接口的所有输入参数都从`RPC`接口`platon_evidences`返回的证据列表中解析而来。

   **输入：**证据类型（双签/双出）、节点ID、违规行为的块高

   **输出：**交易Hash（如果证据已举报过，则返回举报交易的Hash，否则返回空）



### 锁仓合约

此合约可用于将资产锁定限制其在一定时间段内进行流通，实现控制一定时间内的总资产流通量或外部人员其它的锁定需求，当资产的锁定期结束后资产将自动转入解锁接收账户（发起锁定时输入的解锁后接收账户），被锁定的资产从被转入锁仓合约后，该笔资产的所属权将归于解锁接收账户，锁定期间该笔资产是不能用于交易，虽然属于接收账户但是金额存在锁仓合约中账户余额中是查询不到的，只能从锁仓合约中查询锁仓记录得知该笔资产。合约将根据发起锁定的人指定的释放规则将资产释放给指定解锁接收人，释放规则可自定义为到达某个时间点时解锁全部并转入接收人账户，也可定义为将一笔资产拆分为N份，分M期进行释放，设定每期释放的时间点释放一份，直到M期后锁定资产全部释放完毕，每次释放完资产及时到达接收者账户可自由支配使用。

处于锁定期间的资产由于受限制不能转账，为了补偿用户损失的资产流动性和利益，可将该笔资产用于质押节点和委托节点以盘活资金获取收益以及抵消通胀所带来的价值稀释。但是当资产用于质押或者委托使用后，锁定期到了资产不会转入接收者账户中，而是需要等到用户解除质押或者解除委托时该笔资产才会转入接收者账户中，锁仓合约的释放规则会根据资产的使用情况进行不同处理，如果用于质押和委托的资金只使用了锁仓中的部分资产，则释放期到时只从未挪用的资金中释放，如果不够释放的金额则当前不进行释放需等待用户撤销挪用时释放。

#### 合约接口

1. 创建锁仓计划

   该接口用于创建一笔资产锁定，将发起者的账户中转入指定金额到锁仓合约中，达到指定时间点时转入指定接受者账户中。

   **输入：**接收者账户，数组（多个锁仓计划，具体每个时间点释放多少资金）

   **输出：**无

2. 查询锁仓计划

   该接口用于查询指定账户下的锁仓计划，指定的账户为解锁接收者账户。

   **输入：**账户

   **输出：**账户下所有未释放的锁仓计划，包括：锁定中的总资金、用于质押和委托的总资金、每个时间点释放的资金



### 委托奖励合约

该合约主要用作处理委托收益相关的业务，当每个用户委托一个节点之后会产生一笔委托记录，每笔委托记录将会得到被委托节点的分红，分红额度根据节点设置的分红比例从节点的收益中计算，分出来的总分红额度将根据节点的总委托均分，每单位委托将得到一定收益因此单笔委托能获得的收益和委托量成正比。此过程在每个结算周期末系统会自动计算每个备选节点给自身所有委托者的分红奖励，所有分红奖励将会立即转入本合约中暂存，也就是每位委托者所获得的收益首先都存在本合约中，需要等待用户主动发起领取收益，系统此时将会计算该用户有多少待领取的收益在本合约中并立即转入用户账户中。

#### 合约接口

1. 领取委托奖励

   此接口用于提取用户尚未领取的委托奖励，当单个用户委托了多个节点产生多笔委托时，该接口单次只处理20笔委托的奖励领取，剩余的则需再次发起（领取20笔的规则是按照每笔委托未领取的结算周期数排序，未领取的周期数越多优先领取该笔委托的奖励）领取操作，如果待领取的委托奖励的数量少于20笔则直接全部进行领取。

   **输入：**无

   **输出：**数组（所领取的每笔委托奖励的明细），其中包括：节点ID、节点质押块高、委托收益

2. 查询委托奖励

   此接口可用于查询接口发起者所有待领取的委托收益明细，也可以指定查询某笔委托或者多笔委托，返回结果将是一个经过排序的收益明细列表，排序规则为按照每笔委托未领取的结算周期数逆序（待领取委托奖励少于20笔，返回数据将不进行排序）。

   **输入：**无

   **输出：**数组（待领取的每笔委托收益明细），其中包括：节点ID、委托收益、节点质押块高

