"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4625],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=s(n),u=l,k=d["".concat(p,".").concat(u)]||d[u]||m[u]||r;return n?a.createElement(k,o(o({ref:t},c),{},{components:n})):a.createElement(k,o({ref:t},c))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[d]="string"==typeof e?e:l,o[1]=i;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7135:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var a=n(7462),l=(n(7294),n(3905));const r={id:"Wasm_Dev_Manual",title:"Getting started",sidebar_label:"Getting started"},o=void 0,i={unversionedId:"Wasm_Dev_Manual",id:"Wasm_Dev_Manual",isDocsHomePage:!1,title:"Getting started",description:"Introduction",source:"@site/../docs/wasm\u5165\u95e8\u624b\u518c.md",sourceDirName:".",slug:"/Wasm_Dev_Manual",permalink:"/docs/en/Wasm_Dev_Manual",editUrl:"https://github.com/PlatONnetwork/docs/tree/master/docs/wasm\u5165\u95e8\u624b\u518c.md",version:"current",frontMatter:{id:"Wasm_Dev_Manual",title:"Getting started",sidebar_label:"Getting started"},sidebar:"docs",previous:{title:"Call Inner Contract",permalink:"/docs/en/Solidity_Inner_Contract"},next:{title:"Development Costs",permalink:"/docs/en/Wasm_Contract_Dev_Costs"}},p=[{value:"Introduction",id:"introduction",children:[]},{value:"Platon-truffle Introduction",id:"platon-truffle-introduction",children:[]},{value:"Create HelloWorld Contract",id:"create-helloworld-contract",children:[]},{value:"Compile HelloWorld Contract",id:"compile-helloworld-contract",children:[]},{value:"Deploly HelloWorld Contract",id:"deploly-helloworld-contract",children:[]},{value:"Call HelloWorld Contract",id:"call-helloworld-contract",children:[]},{value:"FAQ",id:"faq",children:[{value:"About Compile",id:"about-compile",children:[]},{value:"About Contract",id:"about-contract",children:[]}]}],s={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,l.kt)(c,(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h3",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"This tutorial is mainly to guide users to create a simple HelloWorld smart contract using wasm language on PlatON, compile, deploy, and call this contract through platon-truffle.If you want to use a richer API."),(0,l.kt)("h3",{id:"platon-truffle-introduction"},"Platon-truffle Introduction"),(0,l.kt)("p",null,"Platon-truffle is a tool provided by PlatON that can compile, deploy, and invoke smart contracts locally. For specific installation and usage manuals, refer to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Platon-truffle develop tools",(0,l.kt)("a",{parentName:"li",href:"https://platon-truffle.readthedocs.io/en/v1.0.0/getting-started/installation.html"},"specific installation")),(0,l.kt)("li",{parentName:"ul"},"Platon-truffle develop tools",(0,l.kt)("a",{parentName:"li",href:"https://platon-truffle.readthedocs.io/en/v1.0.0/"},"usage manuals"))),(0,l.kt)("h3",{id:"create-helloworld-contract"},"Create HelloWorld Contract"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},'#include <platon/platon.hpp>\n#include <string>\nusing namespace platon;\n\nclass message {\n   public:\n      std::string head;\n      PLATON_SERIALIZE(message, (head))\n};\n\nclass my_message : public message {\n   public:\n      std::string body;\n      std::string end;\n      PLATON_SERIALIZE_DERIVED(my_message, message, (body)(end))\n};\n\nCONTRACT HelloWorld : public platon::Contract{\n   public:\n      ACTION void init(const my_message &one_message){\n        info.self().push_back(one_message);\n      }\n\n      ACTION void add_message(const my_message &one_message){\n          info.self().push_back(one_message);\n      }\n\n      CONST uint8_t get_message_size(){\n          return info.self().size();\n      }\n\n      CONST std::string get_message_body(const uint8_t index){\n          return info.self()[index].body;\n      }\n\n   private:\n      platon::StorageType<"myvector"_n, std::vector<my_message>> info;\n};\n\nPLATON_DISPATCH(HelloWorld, (init)(add_message)(get_message_size)(get_message_body))\n\n')),(0,l.kt)("p",null,"Contract Files Description:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Each contract file has only one contract class. The contract class is decorated with Contract. It must be publicly inherited from platon :: Contract and must have an init function.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"ACTION and CONST qualified member functions represent callable functions, and such member functions cannot be overloaded. The ACTION function will modify the data on the chain. The CONST function just queries the attributes and does not modify the data on the chain.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"The type in the callable function parameter list is a custom type. In this type definition, you need to add the PLATON_SERIALIZE macro to declare the serialization function. This type inherits from other types. You need to add the PLATON_SERIALIZE_DERIVED macro to declare the serialization function.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Callable functions can only be called externally if the unified entry function is defined in the PLATON_DISPATCH macro.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"At present, platon will persistently store member variables of the contract class. The member variables must be of type platon :: StorageType. The first parameter string of the platon :: StorageType template is followed by _n, and the string must be .12345abcdefghijklmnopqrstuvwxyz. 32 characters Characters. The second parameter is the concrete type of the actual storage. Member function modification member variables need to obtain an instance of a specific type through the self () function, and then execute the corresponding instance function.")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"The second parameter type of the platon :: StorageType template is a custom type. A PLATON_SERIALIZE macro must be added to this type definition to declare a serialization function. This type inherits from other types. A PLATON_SERIALIZE_DERIVED macro must be added to declare a serialization function."))),(0,l.kt)("h3",{id:"compile-helloworld-contract"},"Compile HelloWorld Contract"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step1.")," Creat new directory for HelloWorld project"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"mkdir HelloWorld && cd HelloWorld\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"The following commands are performed in the HelloWorld directory without special instructions")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step2."),"  Init project"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"platon-truffle init\n")),(0,l.kt)("p",null,"After the command is executed, project directory structure is as follows:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"contracts/")," wasm contract directory")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"migrations/")," depoly file directory")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"test/")," test script directory")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"truffle-config.js")," platon-truffle config"))),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step3.")," Move HelloWorld contract compiled in to HelloWorld/contracts/"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"ls contracts/\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"HelloWorld.cpp")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step4.")," Modify the platon-truffle configuration file truffle-config.js and add the compiled wasm contract version number"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,l.kt)("p",null,"Truffle-config.js content is  as follows:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'compilers: {\n     wasm: {\n           version: "1.0.0"\n     }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step5."),"  Compile contract"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"platon-truffle compile\n")),(0,l.kt)("p",null,"After the command is executed, project directory structure is as follows:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"build/")," wasm contract directory after compiled"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"build/contracts/HelloWorld.abi.json"),"  HelloWorld contract compiled abi interface file"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"build/contracts/HelloWorld.wasm"),"  HelloWorld contract compiled binary")),(0,l.kt)("h3",{id:"deploly-helloworld-contract"},"Deploly HelloWorld Contract"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step1.")," Setting config  information for blockchain in truffle-config.js"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"vim truffle-config.js\n")),(0,l.kt)("p",null,"Set blockchain network  info"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'networks: {\n    development: {\n       host: "10.1.1.6",     // blockchain server address\n       port: 8806,            // server port\n       network_id: "*",       // Any network (default: none)\n       from: "lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc",\n       gas: 999999,\n       gasPrice: 1000000000,\n    },\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"step2."),"  Unlock wallet account"),(0,l.kt)("p",null,"Enter the platon-truffle console"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"platon-truffle console\n")),(0,l.kt)("p",null,"Import the private key (you can skip this step if you have already imported it)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'web3.platon.personal.importRawKey("Your wallet private key","Your wallet password");\n')),(0,l.kt)("p",null,"Successful import will see the address corresponding to the private key as follows\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"'lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc'\n")),(0,l.kt)("p",null,"Unlock wallet account"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"}," web3.platon.personal.unlockAccount('Your wallet address','Your wallet password',999999);\n")),(0,l.kt)("p",null,"After unlocking successfully, you will see the following information\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"ture\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step3.")," Deploy contract"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'platon-truffle deploy --wasm --contract-name HelloWorld --params \'[[["1"], "2", "3"]]\'\n')),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"HelloWorld")," deployed contract"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"params")," parameters of contract init function")),(0,l.kt)("p",null,"If deploying successfully\uff0cyou will see log info as follows:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"receipt:  { blockHash:\n   '0x266733b693ba650315a59c34e72804c06ca3e27fab145625797bd42259b572c5',\n  blockNumber: 70441,\n  contractAddress: 'lat1nk4errnjlulaz5y57xt4djkx3h4jjl7yy9dzqn',\n  cumulativeGasUsed: 291314,\n  from: 'lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc',\n  gasUsed: 291314,\n  logs: [],\n  logsBloom:\n   '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\n  status: true,\n  to: null,\n  transactionHash:\n   '0x60946ebf0ccddc76a0234353435de73e7901888227fb2f03922fb0ce265a4e9d',\n  transactionIndex: 0 }\n  contract HelloWorld deployed successfully\n======================\n\n   > transactionHash:     0x60946ebf0ccddc76a0234353435de73e7901888227fb2f03922fb0ce265a4e9d\n   > contract address:    lat1nk4errnjlulaz5y57xt4djkx3h4jjl7yy9dzqn\n   > block number:        70441\n   > block timestamp:     1583247148341\n   > account:             lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc\n   > balance:             3533694129556768659166595001485837031654967793751237866225582808584074296\n   > gas limit:           100000000\n   > gas used:            291314\n   > gas price:           0.000000050000000004 LAT\n   > total cost:          0.014565700001165256 LAT\n")),(0,l.kt)("h3",{id:"call-helloworld-contract"},"Call HelloWorld Contract"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step1."),"  Enter the platon-truffle console"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"platon-truffle console\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"You can execute command in platon-truffle console")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step2."),"  Create contract object"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'var abi = [{"baseclass":[],"fields":[{"name":"head","type":"string"}],"name":"message","type":"struct"},{"baseclass":["message"],"fields":[{"name":"body","type":"string"},{"name":"end","type":"string"}],"name":"my_message","type":"struct"},{"constant":false,"input":[{"name":"one_message","type":"my_message"}],"name":"init","output":"void","type":"Action"},{"constant":false,"input":[{"name":"one_message","type":"my_message"}],"name":"add_message","output":"void","type":"Action"},{"constant":true,"input":[],"name":"get_message_size","output":"uint8","type":"Action"},{"constant":true,"input":[{"name":"index","type":"uint8"}],"name":"get_message_body","output":"string","type":"Action"}];\nvar contractAddr = \'lat1nk4errnjlulaz5y57xt4djkx3h4jjl7yy9dzqn\';\n\nvar helloworld = new web3.platon.Contract(abi,contractAddr,{vmType: 1 }); \n')),(0,l.kt)("p",null,"Description\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"abi"),"  the interface provided by the contract to external calls\uff0cthe abi  in the file compiled \uff1a",(0,l.kt)("inlineCode",{parentName:"li"},"HelloWorld/build/contracts/HelloWorld.json")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"contractAddr")," contract address"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"helloWorld")," contract object created")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step3."),"  Call contract"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"helloworld.methods.add_message('[[[\"5\"], \"6\", \"7\"]]').send({\n    from: 'lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc',gas: 999999\n}).on('receipt', function(receipt) {\n    console.log(receipt);\n}).on('error', console.error);\n")),(0,l.kt)("p",null,"Description\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"helloWorld")," the contract object created"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"methods")," specify the call method"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"add_message"),"  method in the HelloWorld contract with a custom my_message input"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"from")," caller's wallet address"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"on")," listen to the result of the contract method executed. If failed, it will print the error info. If succeeded, the console will print the receipt as belows:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{ blockHash:\n   '0x669c7b8cb938cc30845e08dc4ceda08f2e17207c267ade97dc5458b445405736',\n  blockNumber: 74665,\n  contractAddress: null,\n  cumulativeGasUsed: 108549,\n  from: 'lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc',\n  gasUsed: 108549,\n  logsBloom:\n   '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\n  status: true,\n  to: 'lat1nk4errnjlulaz5y57xt4djkx3h4jjl7yy9dzqn',\n  transactionHash:\n   '0x2b5e590df7e70ad428b1ccb06bda5dcce47f84c4d981c2fb475aca9ec9d0000a',\n  transactionIndex: 0,\n  events: {} }\n{ blockHash:\n   '0x669c7b8cb938cc30845e08dc4ceda08f2e17207c267ade97dc5458b445405736',\n  blockNumber: 74665,\n  contractAddress: null,\n  cumulativeGasUsed: 108549,\n  from: 'lat1wxadw8yzr6qxdw5yl3f2surp6ue6f03e07kcqc',\n  gasUsed: 108549,\n  logsBloom:\n   '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\n  status: true,\n  to: 'lat1nk4errnjlulaz5y57xt4djkx3h4jjl7yy9dzqn',\n  transactionHash:\n   '0x2b5e590df7e70ad428b1ccb06bda5dcce47f84c4d981c2fb475aca9ec9d0000a',\n  transactionIndex: 0,\n  events: {} }\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Step4."),"  Query contract"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"helloworld.methods.get_message_body(0).call()\n")),(0,l.kt)("p",null,"Description\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"helloWorld")," the contract object created"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"methods")," specify the call method"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"get_message_body")," method in the HelloWorld contract, which has an input parameter of type int"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"call")," specify the query method")),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"faq"},"FAQ"),(0,l.kt)("h3",{id:"about-compile"},"About Compile"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"How to use ",(0,l.kt)("inlineCode",{parentName:"p"},"platon-cpp")," for compile multiple ",(0,l.kt)("inlineCode",{parentName:"p"},"cpp")," files?"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"platon-cpp ./test.cpp ./test1.cpp\n")),(0,l.kt)("p",{parentName:"li"},"Only allowing exists one contract class.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"How to specified output directory and filename when use ",(0,l.kt)("inlineCode",{parentName:"p"},"platon-cpp"),"\nto compile contract?"),(0,l.kt)("p",{parentName:"li"},"Use ",(0,l.kt)("inlineCode",{parentName:"p"},"-o")," flag, and must be specified output directory and filename at the\nsame time."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"platon-cpp ./test.cpp -o ./out/test.wasm\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"What data types does ABI support?"),(0,l.kt)("p",{parentName:"li"},"Generate ABI supported types and conversion rules as follows:"))),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"ABI"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"bool")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"uint8_t"),(0,l.kt)("td",{parentName:"tr",align:null},"uint8")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"uint16_t"),(0,l.kt)("td",{parentName:"tr",align:null},"uint16")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"uint32_t"),(0,l.kt)("td",{parentName:"tr",align:null},"uint32")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"uint64_t"),(0,l.kt)("td",{parentName:"tr",align:null},"uint64")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"int8_t"),(0,l.kt)("td",{parentName:"tr",align:null},"int8")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"int16_t"),(0,l.kt)("td",{parentName:"tr",align:null},"int16")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"int32_t"),(0,l.kt)("td",{parentName:"tr",align:null},"int32")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"int64_t"),(0,l.kt)("td",{parentName:"tr",align:null},"int64")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"bytes"),(0,l.kt)("td",{parentName:"tr",align:null},"uint8","[","]")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::string"),(0,l.kt)("td",{parentName:"tr",align:null},"string")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::vector","<","T",">"),(0,l.kt)("td",{parentName:"tr",align:null},"T","[","]")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::array","[","T, N","]"),(0,l.kt)("td",{parentName:"tr",align:null},"T","[","N","]")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::pair","<","T, U",">"),(0,l.kt)("td",{parentName:"tr",align:null},"pair","<","T, U",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::set","<","T",">"),(0,l.kt)("td",{parentName:"tr",align:null},"set","<","T",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::map","<","T, V",">"),(0,l.kt)("td",{parentName:"tr",align:null},"map","<","T, V",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"std::list","<","T",">"),(0,l.kt)("td",{parentName:"tr",align:null},"list","<","T",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"FixedHash","<","N",">"),(0,l.kt)("td",{parentName:"tr",align:null},"FixedHash","<","N",">")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"u128"),(0,l.kt)("td",{parentName:"tr",align:null},"uint128")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"bigint"),(0,l.kt)("td",{parentName:"tr",align:null},"uint128")))),(0,l.kt)("h3",{id:"about-contract"},"About Contract"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"How to output contract debug logs in the ",(0,l.kt)("inlineCode",{parentName:"p"},"platon")," process?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Add ",(0,l.kt)("inlineCode",{parentName:"p"},"#undef NDEBUG")," at the first line of contract codes, and must before\nheader file included."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"#undef NDEBUG\n\n#include <platon/platon.hpp>\n\n//...\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},(0,l.kt)("inlineCode",{parentName:"p"},"platon")," startup command specifies log level 4 and enable debug flag."),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"./platon --debug --verbosity 4 ...\n"))))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"How to write a contract can effectively reduce Gas consumption?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Use reference arguments"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"void test(const std::string& str) {}\n"))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"Return rvalue reference"))),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"std::vector<std::string>&& test() {\n    std::vector<std::string> v;\n    // ...\n    return std::move(v);\n}\n")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Try not to apply for large blocks of memory"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"What should I pay attention to when using ",(0,l.kt)("inlineCode",{parentName:"p"},"StorageType"),"?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Should be initialized in ",(0,l.kt)("inlineCode",{parentName:"li"},"init()"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},' CONTRAT Hello : public Contract {\n public:\n   ACTION void init() {\n       s_.self() = "test";\n   }\n private:\n   StorageType<"test"_n, std::string> s_;\n };\n')))),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre"},"  \n- It is recommended to use a specialized type of `StorageType` directly\n  \n  + Uint8\n  + Int8\n  + Uint16\n  + Int16\n  + Uint\n  + Int\n  + Uint64\n  + Int64\n  + String\n  + Vector\n  + Set\n  + Map\n  + Array\n  + Tuple\n"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"What is the difference between ",(0,l.kt)("inlineCode",{parentName:"p"},"StorageType")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"platon::db::Map"),",\n",(0,l.kt)("inlineCode",{parentName:"p"},"platon::db::Array"),"?"),(0,l.kt)("p",{parentName:"li"},"From the underlying storage level, the implementation of ",(0,l.kt)("inlineCode",{parentName:"p"},"StorageType")," is\nserialized as a whole, and then stored in the database. ",(0,l.kt)("inlineCode",{parentName:"p"},"platon::db::Map"),"\nand ",(0,l.kt)("inlineCode",{parentName:"p"},"platon::db::Array")," serialize each element of the container as K/V is\nstored to the database. For large-scale data, ",(0,l.kt)("inlineCode",{parentName:"p"},"platon::db::Map")," and\n",(0,l.kt)("inlineCode",{parentName:"p"},"platon::db::Array")," perform better."),(0,l.kt)("p",{parentName:"li"},"When implementing a contract, a suitable storage structure should be\nselected based on the size of the data.")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"RLP serialization/deserialization What C++ standard library types are\nsupported?"),(0,l.kt)("p",{parentName:"li"},"The following C ++ standard library types are supported:"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"std::string"),(0,l.kt)("li",{parentName:"ul"},"std::vector"),(0,l.kt)("li",{parentName:"ul"},"std::map"),(0,l.kt)("li",{parentName:"ul"},"std::list"),(0,l.kt)("li",{parentName:"ul"},"std::array"),(0,l.kt)("li",{parentName:"ul"},"std::set"),(0,l.kt)("li",{parentName:"ul"},"std::pair"),(0,l.kt)("li",{parentName:"ul"},"std::tuple"))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"How do custom types support RLP serialization/deserialization?"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Macro ",(0,l.kt)("inlineCode",{parentName:"li"},"PLATON_SERIALIZE")," for common types")),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"   struct Base {\n   int a;\n   std::string b;\n\n   PLATON_SERIALIZE(Base, (a)(b));\n   };\n")),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"The derived class uses the macro\xa0",(0,l.kt)("inlineCode",{parentName:"li"},"PLATON_SERIALIZE_DERIVED"),", and the base class also uses the macro\xa0",(0,l.kt)("inlineCode",{parentName:"li"},"PLATON_SERIALIZE"))),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"struct Derived : public Base {\n  int c;\n  int d;\n\n  PLATON_SERIALIZE_DERIVED(Derived, Base, (c)(d));\n};\n")))))}d.isMDXComponent=!0}}]);